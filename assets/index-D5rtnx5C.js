(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();class f{constructor(){this.currentMode="create",this.currentElementType="object",this.elements=[],this.connections=[],this.selectedElement=null,this.dragging=!1,this.dragOffset={x:0,y:0},this.connectionStart=null,this.zoom=1,this.pan={x:0,y:0},this.contextMenuTarget=null,this.editingElement=null}setMode(t){this.currentMode=t}setElementType(t){this.currentElementType=t}addElement(t){this.elements.push(t)}removeElement(t){const e=this.elements.findIndex(n=>n.id===t);e!==-1&&this.elements.splice(e,1)}addConnection(t){this.connections.push(t)}removeConnection(t){const e=this.connections.findIndex(n=>n.id===t);e!==-1&&this.connections.splice(e,1)}getElementById(t){return this.elements.find(e=>e.id===t)}getElementAt(t,e){return this.elements.find(n=>t>=n.cornerX&&t<=n.cornerX+n.width&&e>=n.cornerY&&e<=n.cornerY+n.height)}selectElement(t){var e;(e=this.selectedElement)!=null&&e.domElement&&this.selectedElement.domElement.classList.remove("selected"),this.selectedElement=t,t!=null&&t.domElement&&t.domElement.classList.add("selected")}clear(){this.elements.forEach(t=>{t.domElement&&t.domElement.remove()}),this.elements=[],this.connections=[],this.selectedElement=null,this.connectionStart=null,this.contextMenuTarget=null,this.editingElement=null}}class y{constructor(t){this.canvas=t}getCanvasRect(){return this.canvas.getBoundingClientRect()}createElementDOM(t){const e=document.createElement("div");e.className=`element ${t.type}`,t.parent&&e.classList.add("has-parent"),e.style.left=t.cornerX+"px",e.style.top=t.cornerY+"px",e.style.width=t.width+"px",e.style.height=t.height+"px",e.textContent=t.text,e.dataset.id=t.id.toString(),e.addEventListener("dblclick",n=>{n.stopPropagation(),this.editElementText(t)}),this.canvas.appendChild(e),t.domElement=e}updateElementPosition(t){t.domElement&&(t.domElement.style.left=t.cornerX+"px",t.domElement.style.top=t.cornerY+"px"),t.children.forEach(e=>this.updateElementPosition(e))}updateElementTextContent(t){t.domElement&&(t.domElement.textContent=t.text)}editElementText(t){const e=prompt("Edit element text:",t.text);e!==null&&(t.text=e,this.updateElementTextContent(t))}createConnectionDOM(t){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.classList.add("connection-svg"),e.style.position="absolute",e.style.pointerEvents="none",e.style.zIndex="1",e.style.overflow="visible";const n=t.from.centerX,s=t.from.centerY,i=t.to.centerX,a=t.to.centerY,l=Math.min(n,i)-20,c=Math.min(s,a)-20,d=Math.max(n,i)+20,p=Math.max(s,a)+20;e.style.left=l+"px",e.style.top=c+"px",e.style.width=d-l+"px",e.style.height=p-c+"px";const r=document.createElementNS("http://www.w3.org/2000/svg","line");r.classList.add("connection-line"),r.setAttribute("x1",(n-l).toString()),r.setAttribute("y1",(s-c).toString()),r.setAttribute("x2",(i-l).toString()),r.setAttribute("y2",(a-c).toString()),r.setAttribute("stroke","rgba(255, 255, 255, 0.8)"),r.setAttribute("stroke-width","2"),e.appendChild(r),this.canvas.appendChild(e)}updateConnections(t){document.querySelectorAll(".connection-svg").forEach(e=>e.remove()),t.forEach(e=>{this.createConnectionDOM(e)})}showContextMenu(t,e){const n=document.getElementById("contextMenu");n&&(n.style.left=t+"px",n.style.top=e+"px",n.classList.remove("hidden"))}hideContextMenu(){const t=document.getElementById("contextMenu");t&&t.classList.add("hidden")}showElementTypeSelection(){const t=document.getElementById("elementTypeSelection");t&&t.classList.remove("hidden")}hideElementTypeSelection(){const t=document.getElementById("elementTypeSelection");t&&t.classList.add("hidden")}updateCanvasCursor(t){this.canvas.className=`canvas ${t}-mode`}updateStatus(t){const e=document.getElementById("status");e&&(e.textContent=t)}setCanvasTransform(t,e,n){this.canvas.style.transform=`scale(${t}) translate(${e}px, ${n}px)`}}class g{constructor(t,e){this.id=Date.now()+Math.random(),this.from=t,this.to=e,t.connections.push(this),e.connections.push(this)}serialize(){return{id:this.id,from:this.from.id,to:this.to.id}}}class u{constructor(t,e,n,s="",i=null){this.id=Date.now()+Math.random(),this.type=t,this.text=s||this.getDefaultText(),this.width=this.getDefaultWidth(),this.height=this.getDefaultHeight(),this._centerX=e,this._centerY=n,this.parent=i,this.children=[],this.connections=[],i&&i.children.push(this)}get centerX(){return this._centerX}get centerY(){return this._centerY}get cornerX(){return this._centerX-this.width/2}get cornerY(){return this._centerY-this.height/2}getCenter(){return{x:this._centerX,y:this._centerY}}updateCenter(t,e){this._centerX=t,this._centerY=e}updateCorner(t,e){this._centerX=t+this.width/2,this._centerY=e+this.height/2}getDefaultText(){return{collection:"Collection",function:"Function",object:"Object",input:"Input",output:"Output"}[this.type]||"AppElement"}getDefaultWidth(){return{collection:120,function:100,object:100,input:80,output:80}[this.type]||100}getDefaultHeight(){return{collection:80,function:60,object:80,input:40,output:40}[this.type]||60}serialize(){return{id:this.id,type:this.type,x:this.centerX,y:this.centerY,text:this.text,width:this.width,height:this.height,parent:this.parent?this.parent.id:null,children:this.children.map(t=>t.id),connections:this.connections.map(t=>t.id)}}}class v{constructor(t,e,n){this.state=t,this.dom=e,this.panel=n}createElementAt(t,e,n=null){const s=new u(this.state.currentElementType,t,e,"",n);return this.state.addElement(s),this.dom.createElementDOM(s),this.state.selectElement(s),this.panel.updatePanel(s),this.render(),s}createChildElement(t){const e=t.centerX+t.width+30,n=t.centerY+t.children.length*55;return this.createElementAt(e,n,t)}deleteElementById(t){var n,s,i;const e=this.state.getElementById(t);e&&(e.parent&&(e.parent.children=e.parent.children.filter(a=>a.id!==t)),e.children.forEach(a=>this.deleteElementById(a.id)),this.state.connections=this.state.connections.filter(a=>a.from.id!==t&&a.to.id!==t),(n=e.domElement)==null||n.remove(),this.state.removeElement(t),((s=this.state.selectedElement)==null?void 0:s.id)===t&&(this.state.selectedElement=null,this.panel.updatePanel(null)),((i=this.state.connectionStart)==null?void 0:i.id)===t&&(this.state.connectionStart=null),this.render())}createConnection(t,e){if(this.state.connections.some(i=>i.from.id===t.id&&i.to.id===e.id||i.from.id===e.id&&i.to.id===t.id))return;const s=new g(t,e);this.state.addConnection(s),this.dom.updateConnections(this.state.connections)}resetConnectionState(){var t,e;(e=(t=this.state.connectionStart)==null?void 0:t.domElement)==null||e.classList.remove("connection-source"),this.state.connectionStart=null,this.updateStatus()}updateStatus(){const t={create:"Create/Child Mode",connection:"Connection Mode",move:"Movement Mode",edit:"Edit Mode"},e={collection:"Collections",function:"Functions",object:"Objects",input:"Inputs",output:"Outputs"};let n=`${t[this.state.currentMode]}`;this.state.currentMode==="create"&&(n+=` - ${e[this.state.currentElementType]}`),this.state.currentMode==="connection"&&this.state.connectionStart&&(n+=" - Select target element"),this.dom.updateStatus(n)}render(){this.dom.updateConnections(this.state.connections)}}function x(o,t,e,n,s){var d;const i=e.getCanvasRect(),a=(o.clientX-i.left)/t.zoom-t.pan.x,l=(o.clientY-i.top)/t.zoom-t.pan.y,c=t.getElementAt(a,l);switch(!c&&t.currentMode!=="connection"&&(t.selectElement(null),n.updatePanel(null)),t.currentMode){case"create":c?o.shiftKey?s.deleteElementById(c.id):s.createChildElement(c):s.createElementAt(a,l);break;case"connection":c?t.connectionStart?c!==t.connectionStart&&(s.createConnection(t.connectionStart,c),s.resetConnectionState()):(t.connectionStart=c,t.selectElement(c),n.updatePanel(c),(d=c.domElement)==null||d.classList.add("connection-source"),s.updateStatus()):s.resetConnectionState();break;case"edit":c&&(t.selectElement(c),n.updatePanel(c),e.editElementText(c));break}}class M{constructor(t,e,n){this.state=t,this.panel=e,this.dom=n,this.handleMouseDown=s=>{var d;if(this.state.currentMode!=="move")return;const i=this.dom.getCanvasRect(),a=(s.clientX-i.left)/this.state.zoom-this.state.pan.x,l=(s.clientY-i.top)/this.state.zoom-this.state.pan.y,c=this.state.getElementAt(a,l);c&&(this.state.dragging=!0,this.state.selectElement(c),this.panel.updatePanel(c),this.state.dragOffset.x=a-c.cornerX,this.state.dragOffset.y=l-c.cornerY,(d=c.domElement)==null||d.classList.add("dragging"),s.preventDefault())},this.handleMouseMove=s=>{if(!this.state.dragging||!this.state.selectedElement||this.state.currentMode!=="move")return;const i=this.dom.getCanvasRect(),a=(s.clientX-i.left)/this.state.zoom-this.state.pan.x,l=(s.clientY-i.top)/this.state.zoom-this.state.pan.y,c=a-this.state.dragOffset.x,d=l-this.state.dragOffset.y;this.state.selectedElement.updateCorner(c,d),this.dom.updateElementPosition(this.state.selectedElement),this.panel.updatePosition(this.state.selectedElement),this.dom.updateConnections(this.state.connections),s.preventDefault()},this.handleMouseUp=()=>{var s;this.state.dragging&&this.state.selectedElement&&(this.state.dragging=!1,(s=this.state.selectedElement.domElement)==null||s.classList.remove("dragging"))}}}function C(o,t,e){o.preventDefault();const n=e.getCanvasRect(),s=(o.clientX-n.left)/t.zoom-t.pan.x,i=(o.clientY-n.top)/t.zoom-t.pan.y,a=t.getElementAt(s,i);a&&(t.contextMenuTarget=a,e.showContextMenu(o.clientX,o.clientY))}function S(o,t,e,n){t.setMode(o),e.updateCanvasCursor(o),n.updateStatus(),o!=="connection"&&n.resetConnectionState(),o==="create"?e.showElementTypeSelection():e.hideElementTypeSelection()}function w(o,t,e){t.setElementType(o),e.updateStatus()}class L{constructor(t,e,n){this.state=t,this.dom=e,this.panel=n,this.handleCanvasClick=s=>x(s,this.state,this.dom,this.panel,this.utils),this.handleMouseDown=s=>this.mouseHandler.handleMouseDown(s),this.handleMouseMove=s=>this.mouseHandler.handleMouseMove(s),this.handleMouseUp=()=>this.mouseHandler.handleMouseUp(),this.handleContextMenu=s=>C(s,this.state,this.dom),this.handleModeChange=s=>S(s,this.state,this.dom,this.utils),this.handleElementTypeChange=s=>w(s,this.state,this.utils),this.utils=new v(t,e,n),this.mouseHandler=new M(this.state,this.panel,this.dom)}}class T{constructor(t,e){this.editElement=()=>{this.appState.contextMenuTarget&&this.domManager.editElementText(this.appState.contextMenuTarget),this.hideContextMenu()},this.duplicateElement=()=>{if(this.appState.contextMenuTarget){const n=new u(this.appState.contextMenuTarget.type,this.appState.contextMenuTarget.centerX+20,this.appState.contextMenuTarget.centerY+20,this.appState.contextMenuTarget.text);this.appState.addElement(n),this.domManager.createElementDOM(n),this.appState.selectElement(n),this.render()}this.hideContextMenu()},this.deleteElement=()=>{this.appState.contextMenuTarget&&this.deleteElementById(this.appState.contextMenuTarget.id),this.hideContextMenu()},this.appState=t,this.domManager=e}hideContextMenu(){this.domManager.hideContextMenu(),this.appState.contextMenuTarget=null}deleteElementById(t){var n,s;const e=this.appState.getElementById(t);e&&(e.parent&&(e.parent.children=e.parent.children.filter(i=>i.id!==t)),e.children.forEach(i=>{this.deleteElementById(i.id)}),this.appState.connections=this.appState.connections.filter(i=>i.from.id!==t&&i.to.id!==t),e.domElement&&e.domElement.remove(),this.appState.removeElement(t),((n=this.appState.selectedElement)==null?void 0:n.id)===t&&(this.appState.selectedElement=null),((s=this.appState.connectionStart)==null?void 0:s.id)===t&&(this.appState.connectionStart=null),this.render())}render(){this.domManager.updateConnections(this.appState.connections)}}class B{constructor(t,e){this.appState=t,this.domManager=e}saveProject(){const t={elements:this.appState.elements.map(a=>a.serialize()),connections:this.appState.connections.map(a=>a.serialize())},e=JSON.stringify(t,null,2),n=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(n),i=document.createElement("a");i.href=s,i.download="application_design.json",i.click(),URL.revokeObjectURL(s)}loadProject(){const t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=e=>{var i;const s=(i=e.target.files)==null?void 0:i[0];if(s){const a=new FileReader;a.onload=l=>{var c;try{const d=(c=l.target)==null?void 0:c.result;if(typeof d=="string"){const p=JSON.parse(d);this.clearCanvas(),p.elements.forEach(r=>{const h=new u(r.type,r.x,r.y,r.text);h.id=r.id,h.width=r.width,h.height=r.height,this.appState.addElement(h),this.domManager.createElementDOM(h)}),p.connections.forEach(r=>{const h=this.appState.getElementById(r.from),m=this.appState.getElementById(r.to);if(h&&m){const E=new g(h,m);E.id=r.id,this.appState.addConnection(E)}}),this.render()}}catch(d){alert("Error loading project: "+d.message)}},a.readAsText(s)}},t.click()}clearCanvas(){this.appState.clear(),document.querySelectorAll(".connection-svg").forEach(t=>t.remove())}render(){this.domManager.updateConnections(this.appState.connections)}}class I{constructor(t,e){this.zoomIn=()=>{this.appState.zoom*=1.2,this.domManager.setCanvasTransform(this.appState.zoom,this.appState.pan.x,this.appState.pan.y)},this.zoomOut=()=>{this.appState.zoom/=1.2,this.domManager.setCanvasTransform(this.appState.zoom,this.appState.pan.x,this.appState.pan.y)},this.resetView=()=>{this.appState.zoom=1,this.appState.pan={x:0,y:0},this.domManager.setCanvasTransform(1,0,0)},this.appState=t,this.domManager=e}}class P{constructor(t,e){this.panelContainer=document.getElementById("editbar"),this.textInput=this._createInputField("Name"),this.idField=this._createReadOnlyProperty("ID"),this.typeField=this._createReadOnlyProperty("Type"),this.xField=this._createReadOnlyProperty("Pos X"),this.yField=this._createReadOnlyProperty("Pos Y"),this.updatePanel=n=>{if(!n){this.panelContainer.classList.add("hidden");return}this.panelContainer.classList.remove("hidden"),this.idField.textContent=n.id.toString(),this.typeField.textContent=n.type,this.textInput.value=n.text,this.xField.textContent=Math.round(n.centerX).toString(),this.yField.textContent=Math.round(n.centerY).toString()},this._handleTextChange=()=>{const n=this.appState.selectedElement;n&&(n.text=this.textInput.value,this.domManager.updateElementTextContent(n))},this.appState=t,this.domManager=e,this.textInput.addEventListener("input",this._handleTextChange)}_createReadOnlyProperty(t){return this._createElement("readonlyPropTemplate","readonlyProps",".propValue",t)}_createInputField(t){const e=this._createElement("inputFieldTemplate","inputFields",".propInput",t);return e.name=t,e.autocomplete="off",e}_createElement(t,e,n,s){const i=document.getElementById(t).cloneNode(!0);return i.id="",i.querySelector(".propLabel").textContent=s,document.getElementById(e).appendChild(i),i.querySelector(n)}updatePosition(t){if(this.appState.selectedElement===t){const e=t.getCenter();this.xField.textContent=Math.round(e.x).toString(),this.yField.textContent=Math.round(e.y).toString()}}}class O{constructor(){this.hideContextMenu=()=>{this.domManager.hideContextMenu(),this.appState.contextMenuTarget=null},this.handleSaveProject=()=>{this.projectManager.saveProject()},this.handleLoadProject=()=>{this.projectManager.loadProject()},this.handleClearCanvas=()=>{confirm("Are you sure you want to clear the canvas? This action cannot be undone.")&&(this.appState.clear(),this.propertiesPanel.updatePanel(null),document.querySelectorAll(".connection-svg").forEach(e=>e.remove()),this.render())};const t=document.getElementById("canvas");if(!t)throw new Error("Canvas element not found");this.appState=new f,this.domManager=new y(t),this.propertiesPanel=new P(this.appState,this.domManager),this.eventHandlers=new L(this.appState,this.domManager,this.propertiesPanel),this.contextMenu=new T(this.appState,this.domManager),this.projectManager=new B(this.appState,this.domManager),this.viewControls=new I(this.appState,this.domManager),this.initializeApp()}initializeApp(){this.setupEventListeners(),this.domManager.updateCanvasCursor(this.appState.currentMode),this.domManager.updateStatus("Ready"),this.render()}setupEventListeners(){this.setupCanvasEvents(),this.setupUIEvents(),this.setupContextMenuEvents(),this.setupProjectEvents(),this.setupViewControlEvents()}setupCanvasEvents(){const t=document.getElementById("canvas");t.addEventListener("click",this.eventHandlers.handleCanvasClick),t.addEventListener("mousedown",this.eventHandlers.handleMouseDown),t.addEventListener("mousemove",this.eventHandlers.handleMouseMove),t.addEventListener("mouseup",this.eventHandlers.handleMouseUp),t.addEventListener("contextmenu",this.eventHandlers.handleContextMenu),t.addEventListener("dragstart",e=>e.preventDefault()),document.addEventListener("click",this.hideContextMenu)}setupUIEvents(){this.setupModeButtons(),this.setupElementTypeButtons()}setupModeButtons(){document.querySelectorAll(".mode-btn").forEach(t=>{t.addEventListener("click",()=>{document.querySelectorAll(".mode-btn").forEach(n=>n.classList.remove("active")),t.classList.add("active");const e=t.dataset.mode;this.eventHandlers.handleModeChange(e)})})}setupElementTypeButtons(){document.querySelectorAll(".element-btn").forEach(t=>{t.addEventListener("click",()=>{document.querySelectorAll(".element-btn").forEach(n=>n.classList.remove("active")),t.classList.add("active");const e=t.dataset.type;this.eventHandlers.handleElementTypeChange(e)})})}setupContextMenuEvents(){const t=document.getElementById("editBtn"),e=document.getElementById("duplicateBtn"),n=document.getElementById("deleteBtn");t&&t.addEventListener("click",this.contextMenu.editElement),e&&e.addEventListener("click",this.contextMenu.duplicateElement),n&&n.addEventListener("click",this.contextMenu.deleteElement)}setupProjectEvents(){const t=document.getElementById("saveBtn"),e=document.getElementById("loadBtn"),n=document.getElementById("clearBtn");t&&t.addEventListener("click",this.handleSaveProject),e&&e.addEventListener("click",this.handleLoadProject),n&&n.addEventListener("click",this.handleClearCanvas)}setupViewControlEvents(){const t=document.getElementById("zoomInBtn"),e=document.getElementById("zoomOutBtn"),n=document.getElementById("resetViewBtn");t&&t.addEventListener("click",this.viewControls.zoomIn),e&&e.addEventListener("click",this.viewControls.zoomOut),n&&n.addEventListener("click",this.viewControls.resetView)}render(){this.domManager.updateConnections(this.appState.connections)}getAppState(){return this.appState}getDOMManager(){return this.domManager}saveProject(){this.handleSaveProject()}loadProject(){this.handleLoadProject()}clearCanvas(){this.handleClearCanvas()}}document.addEventListener("DOMContentLoaded",()=>{try{const o=new O;window.app=o,console.log("Application initialized successfully")}catch(o){console.error("Failed to initialize application:",o),alert("Failed to initialize application. Please check the console for more details.")}});
