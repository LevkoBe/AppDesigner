(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=e(s);fetch(s.href,i)}})();class f{constructor(){this.currentMode="create",this.currentElementType="object",this.elements=[],this.connections=[],this.selectedElement=null,this.dragging=!1,this.dragOffset={x:0,y:0},this.connectionStart=null,this.zoom=1,this.pan={x:0,y:0},this.contextMenuTarget=null,this.editingElement=null}setMode(t){this.currentMode=t}setElementType(t){this.currentElementType=t}addElement(t){this.elements.push(t)}removeElement(t){const e=this.elements.findIndex(n=>n.id===t);e!==-1&&this.elements.splice(e,1)}addConnection(t){this.connections.push(t)}removeConnection(t){const e=this.connections.findIndex(n=>n.id===t);e!==-1&&this.connections.splice(e,1)}getElementById(t){return this.elements.find(e=>e.id===t)}getElementAt(t,e){return this.elements.find(n=>t>=n.cornerX&&t<=n.cornerX+n.width&&e>=n.cornerY&&e<=n.cornerY+n.height)}selectElement(t){var e;(e=this.selectedElement)!=null&&e.domElement&&this.selectedElement.domElement.classList.remove("selected"),this.selectedElement=t,t!=null&&t.domElement&&t.domElement.classList.add("selected")}clear(){this.elements.forEach(t=>{t.domElement&&t.domElement.remove()}),this.elements=[],this.connections=[],this.selectedElement=null,this.connectionStart=null,this.contextMenuTarget=null,this.editingElement=null}}class y{constructor(t){this.canvas=t}getCanvasRect(){return this.canvas.getBoundingClientRect()}createElementDOM(t){const e=document.createElement("div");e.className=`element ${t.type}`,t.parent&&e.classList.add("has-parent"),e.style.left=t.cornerX+"px",e.style.top=t.cornerY+"px",e.style.width=t.width+"px",e.style.height=t.height+"px",e.textContent=t.text,e.dataset.id=t.id.toString(),e.addEventListener("dblclick",n=>{n.stopPropagation(),this.editElementText(t)}),this.canvas.appendChild(e),t.domElement=e}updateElementPosition(t){t.domElement&&(t.domElement.style.left=t.cornerX+"px",t.domElement.style.top=t.cornerY+"px"),t.children.forEach(e=>this.updateElementPosition(e))}updateElementTextContent(t){t.domElement&&(t.domElement.textContent=t.text)}editElementText(t){const e=prompt("Edit element text:",t.text);e!==null&&(t.text=e,this.updateElementTextContent(t))}createConnectionDOM(t){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.classList.add("connection-svg"),e.style.position="absolute",e.style.pointerEvents="none",e.style.zIndex="1",e.style.overflow="visible";const n=t.from.centerX,s=t.from.centerY,i=t.to.centerX,o=t.to.centerY,d=Math.min(n,i)-20,r=Math.min(s,o)-20,l=Math.max(n,i)+20,h=Math.max(s,o)+20;e.style.left=d+"px",e.style.top=r+"px",e.style.width=l-d+"px",e.style.height=h-r+"px";const c=document.createElementNS("http://www.w3.org/2000/svg","line");c.classList.add("connection-line"),c.setAttribute("x1",(n-d).toString()),c.setAttribute("y1",(s-r).toString()),c.setAttribute("x2",(i-d).toString()),c.setAttribute("y2",(o-r).toString()),c.setAttribute("stroke","rgba(255, 255, 255, 0.8)"),c.setAttribute("stroke-width","2"),e.appendChild(c),this.canvas.appendChild(e)}updateConnections(t){document.querySelectorAll(".connection-svg").forEach(e=>e.remove()),t.forEach(e=>{this.createConnectionDOM(e)})}showContextMenu(t,e){const n=document.getElementById("contextMenu");n&&(n.style.left=t+"px",n.style.top=e+"px",n.classList.remove("hidden"))}hideContextMenu(){const t=document.getElementById("contextMenu");t&&t.classList.add("hidden")}showElementTypeSelection(){const t=document.getElementById("elementTypeSelection");t&&t.classList.remove("hidden")}hideElementTypeSelection(){const t=document.getElementById("elementTypeSelection");t&&t.classList.add("hidden")}updateCanvasCursor(t){this.canvas.className=`canvas ${t}-mode`}updateStatus(t){const e=document.getElementById("status");e&&(e.textContent=t)}setCanvasTransform(t,e,n){this.canvas.style.transform=`scale(${t}) translate(${e}px, ${n}px)`}}class g{constructor(t,e){this.id=Date.now()+Math.random(),this.from=t,this.to=e,t.connections.push(this),e.connections.push(this)}serialize(){return{id:this.id,from:this.from.id,to:this.to.id}}}class u{constructor(t,e,n,s="",i=null){this.id=Date.now()+Math.random(),this.type=t,this.text=s||this.getDefaultText(),this.width=this.getDefaultWidth(),this.height=this.getDefaultHeight(),this._centerX=e,this._centerY=n,this.parent=i,this.children=[],this.connections=[],i&&i.children.push(this)}get centerX(){return this._centerX}get centerY(){return this._centerY}get cornerX(){return this._centerX-this.width/2}get cornerY(){return this._centerY-this.height/2}getCenter(){return{x:this._centerX,y:this._centerY}}updateCenter(t,e){this._centerX=t,this._centerY=e}updateCorner(t,e){this._centerX=t+this.width/2,this._centerY=e+this.height/2}getDefaultText(){return{collection:"Collection",function:"Function",object:"Object",input:"Input",output:"Output"}[this.type]||"AppElement"}getDefaultWidth(){return{collection:120,function:100,object:100,input:80,output:80}[this.type]||100}getDefaultHeight(){return{collection:80,function:60,object:80,input:40,output:40}[this.type]||60}serialize(){return{id:this.id,type:this.type,x:this.centerX,y:this.centerY,text:this.text,width:this.width,height:this.height,parent:this.parent?this.parent.id:null,children:this.children.map(t=>t.id),connections:this.connections.map(t=>t.id)}}}class v{constructor(t,e,n){this.state=t,this.dom=e,this.panel=n}createElementAt(t,e,n=null){const s=new u(this.state.currentElementType,t,e,"",n);return this.state.addElement(s),this.dom.createElementDOM(s),this.state.selectElement(s),this.panel.updatePanel(s),this.render(),s}createChildElement(t){const e=t.centerX+t.width+30,n=t.centerY+t.children.length*55;return this.createElementAt(e,n,t)}deleteElementById(t){var n,s,i;const e=this.state.getElementById(t);e&&(e.parent&&(e.parent.children=e.parent.children.filter(o=>o.id!==t)),e.children.forEach(o=>this.deleteElementById(o.id)),this.state.connections=this.state.connections.filter(o=>o.from.id!==t&&o.to.id!==t),(n=e.domElement)==null||n.remove(),this.state.removeElement(t),((s=this.state.selectedElement)==null?void 0:s.id)===t&&(this.state.selectedElement=null,this.panel.updatePanel(null)),((i=this.state.connectionStart)==null?void 0:i.id)===t&&(this.state.connectionStart=null),this.render())}createConnection(t,e){if(this.state.connections.some(i=>i.from.id===t.id&&i.to.id===e.id||i.from.id===e.id&&i.to.id===t.id))return;const s=new g(t,e);this.state.addConnection(s),this.dom.updateConnections(this.state.connections)}resetConnectionState(){var t,e;(e=(t=this.state.connectionStart)==null?void 0:t.domElement)==null||e.classList.remove("connection-source"),this.state.connectionStart=null,this.updateStatus()}updateStatus(){const t={create:"Create/Child Mode",connection:"Connection Mode",move:"Movement Mode",edit:"Edit Mode"},e={collection:"Collections",function:"Functions",object:"Objects",input:"Inputs",output:"Outputs"};let n=`${t[this.state.currentMode]}`;this.state.currentMode==="create"&&(n+=` - ${e[this.state.currentElementType]}`),this.state.currentMode==="connect"&&this.state.connectionStart&&(n+=" - Select target element"),this.dom.updateStatus(n)}render(){this.dom.updateConnections(this.state.connections)}}function x(a,t,e){a.preventDefault();const n=e.getCanvasRect(),s=(a.clientX-n.left)/t.zoom-t.pan.x,i=(a.clientY-n.top)/t.zoom-t.pan.y,o=t.getElementAt(s,i);o&&(t.contextMenuTarget=o,e.showContextMenu(a.clientX,a.clientY))}function M(a,t,e,n){t.setMode(a),e.updateCanvasCursor(a),n.updateStatus(),a!=="connect"&&n.resetConnectionState(),a==="create"?e.showElementTypeSelection():e.hideElementTypeSelection()}function C(a,t,e){t.setElementType(a),e.updateStatus()}class S{constructor(t,e,n,s){this.dom=t,this.panel=e,this.state=n,this.utils=s,this.handleMouseDown=i=>{var l,h;const[o,d,r]=this.defineClicked(i);this.state.currentMode==="connect"&&!this.state.connectionStart&&o&&(this.state.connectionStart=o,this.state.selectElement(o),this.panel.updatePanel(o),(l=o.domElement)==null||l.classList.add("connection-source"),this.utils.updateStatus()),this.state.currentMode==="move"&&o&&(this.state.dragging=!0,this.state.selectElement(o),this.panel.updatePanel(o),this.state.dragOffset.x=d-o.cornerX,this.state.dragOffset.y=r-o.cornerY,(h=o.domElement)==null||h.classList.add("dragging"),i.preventDefault())},this.handleMouseMove=i=>{if(!this.state.dragging||!this.state.selectedElement||this.state.currentMode!=="move")return;const o=this.dom.getCanvasRect(),d=(i.clientX-o.left)/this.state.zoom-this.state.pan.x,r=(i.clientY-o.top)/this.state.zoom-this.state.pan.y,l=d-this.state.dragOffset.x,h=r-this.state.dragOffset.y;this.state.selectedElement.updateCorner(l,h),this.dom.updateElementPosition(this.state.selectedElement),this.panel.updatePosition(this.state.selectedElement),this.dom.updateConnections(this.state.connections),i.preventDefault()},this.handleMouseUp=()=>{var i;this.state.dragging&&this.state.selectedElement&&(this.state.dragging=!1,(i=this.state.selectedElement.domElement)==null||i.classList.remove("dragging"))}}defineClicked(t){const e=this.dom.getCanvasRect(),n=(t.clientX-e.left)/this.state.zoom-this.state.pan.x,s=(t.clientY-e.top)/this.state.zoom-this.state.pan.y;return[this.state.getElementAt(n,s),n,s]}handleCanvasClick(t){var i;const[e,n,s]=this.defineClicked(t);switch(!e&&this.state.currentMode!=="connect"&&(this.state.selectElement(null),this.panel.updatePanel(null)),this.state.currentMode){case"create":e?t.shiftKey?this.utils.deleteElementById(e.id):this.utils.createChildElement(e):this.utils.createElementAt(n,s);break;case"connect":e?this.state.connectionStart?e!==this.state.connectionStart&&(this.utils.createConnection(this.state.connectionStart,e),this.utils.resetConnectionState()):(this.state.connectionStart=e,this.state.selectElement(e),this.panel.updatePanel(e),(i=e.domElement)==null||i.classList.add("connection-source"),this.utils.updateStatus()):this.utils.resetConnectionState();break;case"edit":e&&(this.state.selectElement(e),this.panel.updatePanel(e),this.dom.editElementText(e));break}}}class w{constructor(t,e,n){this.state=t,this.dom=e,this.panel=n,this.handleCanvasClick=s=>this.clickHandler.handleCanvasClick(s),this.handleMouseDown=s=>this.clickHandler.handleMouseDown(s),this.handleMouseMove=s=>this.clickHandler.handleMouseMove(s),this.handleMouseUp=()=>this.clickHandler.handleMouseUp(),this.handleContextMenu=s=>x(s,this.state,this.dom),this.handleModeChange=s=>M(s,this.state,this.dom,this.utils),this.handleElementTypeChange=s=>C(s,this.state,this.utils),this.utils=new v(t,e,n),this.clickHandler=new S(this.dom,this.panel,this.state,this.utils)}}class L{constructor(t,e){this.editElement=()=>{this.appState.contextMenuTarget&&this.domManager.editElementText(this.appState.contextMenuTarget),this.hideContextMenu()},this.duplicateElement=()=>{if(this.appState.contextMenuTarget){const n=new u(this.appState.contextMenuTarget.type,this.appState.contextMenuTarget.centerX+20,this.appState.contextMenuTarget.centerY+20,this.appState.contextMenuTarget.text);this.appState.addElement(n),this.domManager.createElementDOM(n),this.appState.selectElement(n),this.render()}this.hideContextMenu()},this.deleteElement=()=>{this.appState.contextMenuTarget&&this.deleteElementById(this.appState.contextMenuTarget.id),this.hideContextMenu()},this.appState=t,this.domManager=e}hideContextMenu(){this.domManager.hideContextMenu(),this.appState.contextMenuTarget=null}deleteElementById(t){var n,s;const e=this.appState.getElementById(t);e&&(e.parent&&(e.parent.children=e.parent.children.filter(i=>i.id!==t)),e.children.forEach(i=>{this.deleteElementById(i.id)}),this.appState.connections=this.appState.connections.filter(i=>i.from.id!==t&&i.to.id!==t),e.domElement&&e.domElement.remove(),this.appState.removeElement(t),((n=this.appState.selectedElement)==null?void 0:n.id)===t&&(this.appState.selectedElement=null),((s=this.appState.connectionStart)==null?void 0:s.id)===t&&(this.appState.connectionStart=null),this.render())}render(){this.domManager.updateConnections(this.appState.connections)}}class T{constructor(t,e){this.appState=t,this.domManager=e}saveProject(){const t={elements:this.appState.elements.map(o=>o.serialize()),connections:this.appState.connections.map(o=>o.serialize())},e=JSON.stringify(t,null,2),n=new Blob([e],{type:"application/json"}),s=URL.createObjectURL(n),i=document.createElement("a");i.href=s,i.download="application_design.json",i.click(),URL.revokeObjectURL(s)}loadProject(){const t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=e=>{var i;const s=(i=e.target.files)==null?void 0:i[0];if(s){const o=new FileReader;o.onload=d=>{var r;try{const l=(r=d.target)==null?void 0:r.result;if(typeof l=="string"){const h=JSON.parse(l);this.clearCanvas(),h.elements.forEach(c=>{const p=new u(c.type,c.x,c.y,c.text);p.id=c.id,p.width=c.width,p.height=c.height,this.appState.addElement(p),this.domManager.createElementDOM(p)}),h.connections.forEach(c=>{const p=this.appState.getElementById(c.from),m=this.appState.getElementById(c.to);if(p&&m){const E=new g(p,m);E.id=c.id,this.appState.addConnection(E)}}),this.render()}}catch(l){alert("Error loading project: "+l.message)}},o.readAsText(s)}},t.click()}clearCanvas(){this.appState.clear(),document.querySelectorAll(".connection-svg").forEach(t=>t.remove())}render(){this.domManager.updateConnections(this.appState.connections)}}class B{constructor(t,e){this.zoomIn=()=>{this.appState.zoom*=1.2,this.domManager.setCanvasTransform(this.appState.zoom,this.appState.pan.x,this.appState.pan.y)},this.zoomOut=()=>{this.appState.zoom/=1.2,this.domManager.setCanvasTransform(this.appState.zoom,this.appState.pan.x,this.appState.pan.y)},this.resetView=()=>{this.appState.zoom=1,this.appState.pan={x:0,y:0},this.domManager.setCanvasTransform(1,0,0)},this.appState=t,this.domManager=e}}class I{constructor(t,e){this.panelContainer=document.getElementById("editbar"),this.textInput=this._createInputField("Name"),this.idField=this._createReadOnlyProperty("ID"),this.typeField=this._createReadOnlyProperty("Type"),this.xField=this._createReadOnlyProperty("Pos X"),this.yField=this._createReadOnlyProperty("Pos Y"),this.updatePanel=n=>{if(!n){this.panelContainer.classList.add("hidden");return}this.panelContainer.classList.remove("hidden"),this.idField.textContent=n.id.toString(),this.typeField.textContent=n.type,this.textInput.value=n.text,this.xField.textContent=Math.round(n.centerX).toString(),this.yField.textContent=Math.round(n.centerY).toString()},this._handleTextChange=()=>{const n=this.appState.selectedElement;n&&(n.text=this.textInput.value,this.domManager.updateElementTextContent(n))},this.appState=t,this.domManager=e,this.textInput.addEventListener("input",this._handleTextChange)}_createReadOnlyProperty(t){return this._createElement("readonlyPropTemplate","readonlyProps",".propValue",t)}_createInputField(t){const e=this._createElement("inputFieldTemplate","inputFields",".propInput",t);return e.name=t,e.autocomplete="off",e}_createElement(t,e,n,s){const i=document.getElementById(t).cloneNode(!0);return i.id="",i.querySelector(".propLabel").textContent=s,document.getElementById(e).appendChild(i),i.querySelector(n)}updatePosition(t){if(this.appState.selectedElement===t){const e=t.getCenter();this.xField.textContent=Math.round(e.x).toString(),this.yField.textContent=Math.round(e.y).toString()}}}class P{constructor(){this.hideContextMenu=()=>{this.domManager.hideContextMenu(),this.appState.contextMenuTarget=null},this.handleSaveProject=()=>{this.projectManager.saveProject()},this.handleLoadProject=()=>{this.projectManager.loadProject()},this.handleClearCanvas=()=>{confirm("Are you sure you want to clear the canvas? This action cannot be undone.")&&(this.appState.clear(),this.propertiesPanel.updatePanel(null),document.querySelectorAll(".connection-svg").forEach(e=>e.remove()),this.render())};const t=document.getElementById("canvas");if(!t)throw new Error("Canvas element not found");this.appState=new f,this.domManager=new y(t),this.propertiesPanel=new I(this.appState,this.domManager),this.eventHandlers=new w(this.appState,this.domManager,this.propertiesPanel),this.contextMenu=new L(this.appState,this.domManager),this.projectManager=new T(this.appState,this.domManager),this.viewControls=new B(this.appState,this.domManager),this.initializeApp()}initializeApp(){this.setupEventListeners(),this.domManager.updateCanvasCursor(this.appState.currentMode),this.domManager.updateStatus("Ready"),this.render()}setupEventListeners(){this.setupCanvasEvents(),this.setupUIEvents(),this.setupContextMenuEvents(),this.setupProjectEvents(),this.setupViewControlEvents()}setupCanvasEvents(){const t=document.getElementById("canvas");t.addEventListener("click",this.eventHandlers.handleCanvasClick),t.addEventListener("mousedown",this.eventHandlers.handleMouseDown),t.addEventListener("mousemove",this.eventHandlers.handleMouseMove),t.addEventListener("mouseup",this.eventHandlers.handleMouseUp),t.addEventListener("contextmenu",this.eventHandlers.handleContextMenu),t.addEventListener("dragstart",e=>e.preventDefault()),document.addEventListener("click",this.hideContextMenu)}setupUIEvents(){this.setupModeButtons(),this.setupElementTypeButtons()}setupModeButtons(){document.querySelectorAll(".mode-btn").forEach(t=>{t.addEventListener("click",()=>{document.querySelectorAll(".mode-btn").forEach(n=>n.classList.remove("active")),t.classList.add("active");const e=t.dataset.mode;this.eventHandlers.handleModeChange(e)})})}setupElementTypeButtons(){document.querySelectorAll(".element-btn").forEach(t=>{t.addEventListener("click",()=>{document.querySelectorAll(".element-btn").forEach(n=>n.classList.remove("active")),t.classList.add("active");const e=t.dataset.type;this.eventHandlers.handleElementTypeChange(e)})})}setupContextMenuEvents(){const t=document.getElementById("editBtn"),e=document.getElementById("duplicateBtn"),n=document.getElementById("deleteBtn");t&&t.addEventListener("click",this.contextMenu.editElement),e&&e.addEventListener("click",this.contextMenu.duplicateElement),n&&n.addEventListener("click",this.contextMenu.deleteElement)}setupProjectEvents(){const t=document.getElementById("saveBtn"),e=document.getElementById("loadBtn"),n=document.getElementById("clearBtn");t&&t.addEventListener("click",this.handleSaveProject),e&&e.addEventListener("click",this.handleLoadProject),n&&n.addEventListener("click",this.handleClearCanvas)}setupViewControlEvents(){const t=document.getElementById("zoomInBtn"),e=document.getElementById("zoomOutBtn"),n=document.getElementById("resetViewBtn");t&&t.addEventListener("click",this.viewControls.zoomIn),e&&e.addEventListener("click",this.viewControls.zoomOut),n&&n.addEventListener("click",this.viewControls.resetView)}render(){this.domManager.updateConnections(this.appState.connections)}getAppState(){return this.appState}getDOMManager(){return this.domManager}saveProject(){this.handleSaveProject()}loadProject(){this.handleLoadProject()}clearCanvas(){this.handleClearCanvas()}}document.addEventListener("DOMContentLoaded",()=>{try{const a=new P;window.app=a,console.log("Application initialized successfully")}catch(a){console.error("Failed to initialize application:",a),alert("Failed to initialize application. Please check the console for more details.")}});
